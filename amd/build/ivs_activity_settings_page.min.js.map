{"version":3,"file":"ivs_activity_settings_page.min.js","sources":["../src/ivs_activity_settings_page.js"],"sourcesContent":["define(['core/notification', 'core/custom_interaction_events', 'core/modal', \n        'core/modal_registry', 'core/modal_factory', 'core/templates', 'core/str', 'core/modal_events'],\n    function(Notification, CustomEvents, Modal, ModalRegistry, ModalFactory, Templates, Str, ModalEvents) {\n        let selectedPanoptoVideo = '';\n        \n        return {\n            init: function (panopto_data) {\n\n                // Hide and update gradepass core function with separate videotest gradepass setting\n                // Please note: The actual setting for grade to pass will be hidden und manipulated by the\n                // activity setting which can be locked in the activity, course and system settings.\n                const modStandardGrade = document.querySelector('#id_modstandardgrade');\n                if (modStandardGrade) {\n                    modStandardGrade.style.display = 'none';\n                }\n\n                // Hide Settings depending on other settings\n                const examModeElement = document.querySelector('#id_exam_mode_enabled_value');\n                if (examModeElement) {\n                    examModeElement.addEventListener('change', function () {\n                        set_display_option('#id_exam_mode_enabled_value', '#id_mod_ivsgrades');\n                    });\n                }\n                \n                // Hide Settings depending on other settings\n                const annotationsElement = document.querySelector('#id_annotations_enabled_value');\n                if (annotationsElement) {\n                    annotationsElement.addEventListener('change', function () {\n                        set_display_option('#id_annotations_enabled_value', '#id_mod_ivsnotification');\n                    });\n                }\n\n                set_display_option('#id_annotations_enabled_value', '#id_mod_ivsnotification');\n                set_display_option('#id_exam_mode_enabled_value', '#id_mod_ivsgrades');\n                set_display_option_timing_mode('#id_match_question_enabled_value', '#fgroup_id_show_realtime_results');\n                set_display_option_timing_mode('#id_match_question_enabled_value', '#fgroup_id_show_timing_take_summary');\n\n                const matchQuestionElement = document.querySelector('#id_match_question_enabled_value');\n                if (matchQuestionElement) {\n                    matchQuestionElement.addEventListener('change', function () {\n                        // Show timing mode checkboxes\n                        set_display_option_timing_mode('#id_match_question_enabled_value', '#fgroup_id_show_realtime_results');\n                        set_display_option_timing_mode('#id_match_question_enabled_value', '#fgroup_id_show_timing_take_summary');\n                    });\n                }\n\n                if (panopto_data) {\n\n                    let servername = panopto_data.servername;\n                    let instancename = panopto_data.instancename;\n                    let sessiongroupid = panopto_data.sessiongroupid;\n                    let iframeURL = 'https://' + servername + \n                        '/Panopto/Pages/Sessions/EmbeddedUpload.aspx?playlistsEnabled=false&instance=' + \n                        instancename + '&folderID=' + sessiongroupid;\n\n                    let btn = document.createElement(\"button\");\n                    btn.innerHTML = panopto_data.buttonname;\n                    btn.classList.add('btn', 'btn-primary', 'panopto-selector');\n                    btn.style.marginLeft = '20px';\n                    \n                    const panoptoVideoElement = document.querySelector('#id_panopto_video');\n                    if (panoptoVideoElement && panoptoVideoElement.parentNode) {\n                        panoptoVideoElement.parentNode.insertBefore(btn, panoptoVideoElement.nextSibling);\n                    }\n\n                    // The event to open the modal\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: 'Panopto videos',\n                        large: true,\n                        body: Templates.render('mod_ivs/panopto_modal', {iframeurl: iframeURL}),\n                    }, [btn])\n                        .done(function (modal) {\n                            modal.getRoot().on(ModalEvents.save, function (e) {\n\n                                // Stop the default save button behaviour which is to close the modal.\n                                e.preventDefault();\n                                modal.hide();\n\n                                if (selectedPanoptoVideo.ids && selectedPanoptoVideo.ids.length <= 1) {\n                                    let panopto_video_name = selectedPanoptoVideo.names;\n                                    let panopto_video_id = selectedPanoptoVideo.ids;\n                                    let panopto_data_obj = JSON.stringify({\n                                        'servername': servername,\n                                        'instancename': instancename,\n                                        'sessiongroupid': sessiongroupid,\n                                        'videoname': panopto_video_name,\n                                        'sessionId': panopto_video_id\n                                    });\n                                    \n                                    const jsonField = document.querySelector('#id_panopto_video_json_field');\n                                    const videoField = document.querySelector('#id_panopto_video');\n                                    \n                                    if (panopto_video_name && panopto_video_name.length == 1) {\n                                        if (jsonField) {\n                                            jsonField.value = panopto_data_obj;\n                                        }\n                                    } else {\n                                        if (jsonField) {\n                                            jsonField.value = '';\n                                            jsonField.setAttribute('value', '');\n                                        }\n                                        if (videoField) {\n                                            videoField.setAttribute('value', '');\n                                        }\n                                    }\n\n                                    if (videoField) {\n                                        videoField.value = panopto_video_name;\n                                    }\n                                }\n                            });\n                        });\n\n                    window.addEventListener('message', (e) => {\n                        let panopto_selected_video_data = JSON.parse(e.data);\n                        selectedPanoptoVideo = JSON.parse(e.data);\n                        if (panopto_selected_video_data.cmd === 'ready') {\n                            let win = document.getElementById('panopto_iframe').contentWindow;\n                            let message = {cmd: 'createEmbeddedFrame'};\n                            win.postMessage(JSON.stringify(message), 'https://' + servername);\n                        }\n                        if (panopto_selected_video_data.cmd === 'deliveryList') {\n                            const modalFooter = document.querySelector('.modal-footer');\n                            const primaryBtn = modalFooter ? modalFooter.querySelector('.btn-primary') : null;\n                            \n                            if (primaryBtn) {\n                                if (panopto_selected_video_data.ids.length > 1) {\n                                    primaryBtn.setAttribute('disabled', 'true');\n                                    primaryBtn.setAttribute('title', panopto_data.tooltip);\n                                } else {\n                                    primaryBtn.removeAttribute('disabled');\n                                    primaryBtn.removeAttribute('title');\n                                }\n                            }\n                        }\n                    });\n                }\n\n            }\n        };\n    });\n\n/**\n * Set visibility depending on checkbox state\n * @param {string} fieldSelector - The field selector\n * @param {string} elementSelector - The element selector\n */\nfunction set_display_option(fieldSelector, elementSelector) {\n    const field = document.querySelector(fieldSelector);\n    const element = document.querySelector(elementSelector);\n    \n    if (field && element) {\n        if (!field.checked) {\n            element.style.display = 'none';\n        } else {\n            element.style.display = '';\n        }\n    }\n}\n\n/**\n * Hide and show timing mode settings\n * @param {string} fieldSelector - The field selector  \n * @param {string} elementSelector - The element selector\n */\nfunction set_display_option_timing_mode(fieldSelector, elementSelector) {\n    const field = document.querySelector(fieldSelector);\n    const element = document.querySelector(elementSelector);\n    \n    if (field && element) {\n        if (field.value != 2) {\n            element.style.display = 'none';\n        } else {\n            element.style.display = '';\n        }\n    }\n}\n"],"names":["set_display_option","fieldSelector","elementSelector","field","document","querySelector","element","checked","style","display","set_display_option_timing_mode","value","define","Notification","CustomEvents","Modal","ModalRegistry","ModalFactory","Templates","Str","ModalEvents","selectedPanoptoVideo","init","panopto_data","modStandardGrade","examModeElement","addEventListener","annotationsElement","matchQuestionElement","servername","instancename","sessiongroupid","iframeURL","btn","createElement","innerHTML","buttonname","classList","add","marginLeft","panoptoVideoElement","parentNode","insertBefore","nextSibling","create","type","types","SAVE_CANCEL","title","large","body","render","iframeurl","done","modal","getRoot","on","save","e","preventDefault","hide","ids","length","panopto_video_name","names","panopto_video_id","panopto_data_obj","JSON","stringify","jsonField","videoField","setAttribute","window","panopto_selected_video_data","parse","data","cmd","message","getElementById","contentWindow","postMessage","modalFooter","primaryBtn","tooltip","removeAttribute"],"mappings":"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"}